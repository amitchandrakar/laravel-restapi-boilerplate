#!/bin/sh

# Fix the path to ensure we can find composer
export PATH=$PATH:/usr/local/bin:/usr/local/sbin:/opt/homebrew/bin

echo "ğŸ” Running pre-commit checks..."

# 1. Check Prettier (Formatting)
echo "âœ¨ Running Prettier Check..."
npx prettier --check .
STATUS=$?

if [ $STATUS -ne 0 ]; then
    echo "âŒ Prettier check failed!"
    echo "ğŸ’¡ Run 'npm run format' to fix formatting issues."
    exit 1
fi

# 2. Check Code Style (Pint)
echo "ğŸ¨ Running Pint (Code Style)..."
# We reference the composer script 'lint' which runs 'pint --test'
composer lint
STATUS=$?

if [ $STATUS -ne 0 ]; then
    echo "âŒ Pint check failed!"
    echo "ğŸ’¡ Run 'composer format' to automatically fix style issues."
    exit 1
fi

# 2. Check Static Analysis (Larastan)
echo "ğŸ§  Running Larastan (Static Analysis)..."
# We reference the composer script 'analyse' which runs 'phpstan analyse'
composer analyse
STATUS=$?

if [ $STATUS -ne 0 ]; then
    echo "âŒ Larastan check failed!"
    echo "ğŸ’¡ Please fix the errors reported above."
    exit 1
fi

echo "âœ… All checks passed! Committing..."
exit 0
